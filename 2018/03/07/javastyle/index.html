<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
 
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="java," />










<meta name="description" content="BigIntegernumberOfTrailingZeros 二进制末尾0的个数 用时27比&amp;gt;&amp;gt;=2，while(i&amp;amp;1==0)快很多 用时1721234567891011public static int numberOfTrailingZeros(int i) &amp;#123;    // HD, Figure 5-14    int y;    if (i == 0) re">
<meta name="keywords" content="java">
<meta property="og:type" content="article">
<meta property="og:title" content="java风格练习">
<meta property="og:url" content="http://blog.iotaa.xyz/2018/03/07/javastyle/index.html">
<meta property="og:site_name" content="Learn &amp; practice">
<meta property="og:description" content="BigIntegernumberOfTrailingZeros 二进制末尾0的个数 用时27比&amp;gt;&amp;gt;=2，while(i&amp;amp;1==0)快很多 用时1721234567891011public static int numberOfTrailingZeros(int i) &amp;#123;    // HD, Figure 5-14    int y;    if (i == 0) re">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://iota-1254040271.cos.ap-shanghai.myqcloud.com/image/javaobj.jpg">
<meta property="og:image" content="https://iota-1254040271.cos.ap-shanghai.myqcloud.com/image/javarefer.jpg">
<meta property="og:image" content="https://iota-1254040271.cos.ap-shanghai.myqcloud.com/image/javaarr.jpg">
<meta property="og:image" content="https://iota-1254040271.cos.ap-shanghai.myqcloud.com/image/javastr.jpg">
<meta property="og:updated_time" content="2018-12-13T08:25:01.714Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="java风格练习">
<meta name="twitter:description" content="BigIntegernumberOfTrailingZeros 二进制末尾0的个数 用时27比&amp;gt;&amp;gt;=2，while(i&amp;amp;1==0)快很多 用时1721234567891011public static int numberOfTrailingZeros(int i) &amp;#123;    // HD, Figure 5-14    int y;    if (i == 0) re">
<meta name="twitter:image" content="https://iota-1254040271.cos.ap-shanghai.myqcloud.com/image/javaobj.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.iotaa.xyz/2018/03/07/javastyle/"/>





  <title>java风格练习 | Learn & practice</title>
  








  <!--prettify代码高亮脚本引入-->

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="top-scroll-bar"></div>
<div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Learn & practice</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.iotaa.xyz/2018/03/07/javastyle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn & practice">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">java风格练习</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>

              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-07T14:18:24+08:00">
                2018-03-07
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-12-13T16:25:01+08:00">
                2018-12-13
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java源码8-netMVCspring-ioNetty-数据库-并发/" itemprop="url" rel="index">
                    <span itemprop="name">java源码8+netMVCspring+ioNetty+数据库+并发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="BigInteger"><a href="#BigInteger" class="headerlink" title="BigInteger"></a>BigInteger</h3><p><code>numberOfTrailingZeros</code> 二进制末尾0的个数 用时27<br>比<code>&gt;&gt;=2</code>，<code>while(i&amp;1==0)</code>快很多 用时172<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">numberOfTrailingZeros</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// HD, Figure 5-14</span></span><br><span class="line">    <span class="keyword">int</span> y;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">31</span>;</span><br><span class="line">    y = i &lt;&lt;<span class="number">16</span>; <span class="keyword">if</span> (y != <span class="number">0</span>) &#123; n = n -<span class="number">16</span>; i = y; &#125;</span><br><span class="line">    y = i &lt;&lt; <span class="number">8</span>; <span class="keyword">if</span> (y != <span class="number">0</span>) &#123; n = n - <span class="number">8</span>; i = y; &#125;</span><br><span class="line">    y = i &lt;&lt; <span class="number">4</span>; <span class="keyword">if</span> (y != <span class="number">0</span>) &#123; n = n - <span class="number">4</span>; i = y; &#125;</span><br><span class="line">    y = i &lt;&lt; <span class="number">2</span>; <span class="keyword">if</span> (y != <span class="number">0</span>) &#123; n = n - <span class="number">2</span>; i = y; &#125;</span><br><span class="line">    <span class="keyword">return</span> n - ((i &lt;&lt; <span class="number">1</span>) &gt;&gt;&gt; <span class="number">31</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="LinkedHashMap-LRU的写法"><a href="#LinkedHashMap-LRU的写法" class="headerlink" title="LinkedHashMap:LRU的写法"></a>LinkedHashMap:LRU的写法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@param</span>  accessOrder the ordering mode </span><br><span class="line"><span class="keyword">true</span> <span class="keyword">for</span>  access-order访问顺序, </span><br><span class="line"><span class="keyword">false</span> <span class="keyword">for</span> insertion-order插入顺序</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="keyword">float</span> loadFactor,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="keyword">boolean</span> accessOrder)</span></span></span><br></pre></td></tr></table></figure>
<h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><p>String+” “原来的string还是在的 要等垃圾回收<br>必用方法：<br>1.<code>char[] toCharArray()</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">char</span>[] toCharArray() &#123;</span><br><span class="line">    <span class="comment">// Cannot use Arrays.copyOf because of class initialization order issues</span></span><br><span class="line">    <span class="keyword">char</span> result[] = <span class="keyword">new</span> <span class="keyword">char</span>[value.length];</span><br><span class="line">    System.arraycopy(value, <span class="number">0</span>, result, <span class="number">0</span>, value.length);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<p>2.<code>String(char[]value)</code> //offset,count<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">char</span> value[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.value = Arrays.copyOf(value, value.length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<p>3.每个字节对应的ASCII码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Arrays.toString(str.getBytes())</span><br></pre></td></tr></table></figure></p>
<hr>
<p>4.<code>startsWith(String prefix,int toffset)</code>指定位置开始是否是prefix开头<br>5.<code>str.replaceAll(&quot;[0-9]&quot;,&quot;*&quot;)</code>,<code>str.replaceAll(&quot;\\d&quot;,&quot;*&quot;)</code><br>6.拆分返回String[]<code>System.out.println(Arrays.toString(c1.split(&quot;\\d&quot;,4)));</code><br>7.静态方法<code>valueOf()</code>转换各种类型为String</p>
<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> String b = <span class="string">"b"</span>;<span class="comment">//变成了常量</span></span><br><span class="line">String b1=b+<span class="string">"1"</span>;<span class="comment">//编译期确定 =&gt;String b2="b1" ==b1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getString</span><span class="params">()</span></span>&#123;<span class="comment">//方法在运行期才能确定</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"c"</span>;&#125;</span><br><span class="line">main&#123;</span><br><span class="line"><span class="keyword">final</span> String c= getString();<span class="comment">//加不加final都false 方法一定在运行期确定</span></span><br><span class="line">String c1=c+<span class="number">1</span>;</span><br><span class="line">String c2=<span class="string">"c1"</span>;</span><br><span class="line">System.out.println(c1==c2);<span class="comment">//不等</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="源码："><a href="#源码：" class="headerlink" title="源码："></a>源码：</h4><p>1.final 的常量只能定义时赋值或在【默认】构造器里赋值一次<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> value[];</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(String original)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.value = original.value;<span class="comment">//将常量池中的值赋值给新创建的String</span></span><br><span class="line">    <span class="keyword">this</span>.hash = original.hash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h3><p>1.<code>finalize</code> 对象被回收时调用 不建议重写<br>2.<code>public final native Class&lt;?&gt; getClass();</code> 获取对象的方法区的类信息</p>
<p><code>Math.abs(Integer.MIN_VALUE+10085)</code>=-2147473563</p>
<hr>
<h3 id="DecimalFormat"><a href="#DecimalFormat" class="headerlink" title="DecimalFormat"></a>DecimalFormat</h3><p>保留两位小数System.out.println(<code>new DecimalFormat(&quot;0.00&quot;).format(pi)</code>);<br>百分比<code>new DecimalFormat(&quot;#.##%&quot;).format(pi)</code></p>
<hr>
<h3 id="字符串存储-紧凑字符串"><a href="#字符串存储-紧凑字符串" class="headerlink" title="字符串存储 紧凑字符串"></a>字符串存储 紧凑字符串</h3><p>Java 中的 char 是两个 bytes 大小.<br>Java 9 中，引入了 <code>Compact Strings</code> 的设计，对字符串进行了大刀阔斧的改进。将数据<br>存储方式从 char 数组，改变为一个 byte 数组加上一个标识编码的所谓 coder，并且将相关字<br>符串操作类都进行了修改。所有相关的 Intrinsic 之类也都进行了重写，以保证没有任何<br>性能损失。</p>
<p>字符串也出现了一些能力退化，比如最大字符串的大小。<br>原来 char 数组的实现，字符串的最大长度就是数组本身的长度限制，但是替换成 byte 数组，<br>同样数组长度下，存储能力是退化了一倍的！ 理论中的极限。</p>
<h4 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h4><p><code>getBytes()/String (byte[] bytes)</code> 等都是隐含着使用平台默认编码</p>
<h3 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h3><p>在 JDK 8 中，字符串拼接操作会自动被 javac 转换为 StringBuilder 操作.<br>JDK 9 里面则是因为 Java 9 为了更加统一字符串操作优化，提供了 StringConcatFactory，作<br>为一个统一的入口。</p>
<h4 id="StringBuffer"><a href="#StringBuffer" class="headerlink" title="StringBuffer"></a>StringBuffer</h4><ol>
<li>线程安全<br>public <code>synchronized</code> StringBuffer append(String str) </li>
</ol>
<ul>
<li>CharSequence字符序列类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String c = a+b+<span class="number">1</span>;<span class="comment">//常量变量相加会产生5个对象 编译器会优化</span></span><br><span class="line">String d = <span class="string">"a"</span>+<span class="number">1</span>+<span class="number">2</span>+<span class="string">"b"</span>;<span class="comment">//常量相加只有一个对象</span></span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">StringBuffer sb = <span class="keyword">new</span> StringBuffer(<span class="number">32</span>);</span><br><span class="line">sb.append(a).append(b).append(<span class="number">1</span>);<span class="comment">//解决常量变量相加 产生3个对象</span></span><br><span class="line">sb.toString();</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="StringBuilder"><a href="#StringBuilder" class="headerlink" title="StringBuilder"></a>StringBuilder</h4><ol>
<li><code>StingBuilder</code>线程不安全</li>
<li>连接大量字符串 .append .toString()</li>
</ol>
<p><code>javap -c</code>查看编译后的指令<br>1.<code>String a =&quot;a&quot;+1;</code>会生成builder加入a1<br>2.<code>String b = a+&quot;b&quot;;</code>执行一次append<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String c=<span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">for</span>(i in <span class="number">5</span>)&#123;</span><br><span class="line">    c+=i;<span class="comment">//会创建5个StringBuilder 应该用append拼接</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="字符串缓存"><a href="#字符串缓存" class="headerlink" title="字符串缓存"></a>字符串缓存</h3><p>String 在 Java 6 以后提供了 intern() 方法，目的是提示 JVM把相应字符串缓存起来，以备重复使用。在我们创建字符串对象并调用 intern() 方法的时候，如果已经有缓存的字符串，就会返回缓存里的实例，否则将其缓存起来。</p>
<ul>
<li><p>一般使用 Java 6 这种历史版本，并不推荐大量使用intern，为什么呢？<br>被缓存的字符串是存在所谓 PermGen 里的，也就是臭名昭著的“永久代”，这个空间是很有限的，也基本不会被 FullGC 之外的垃圾收<br>集照顾到。所以，如果使用不当，就会OOM。</p>
</li>
<li><p>在后续版本中，这个缓存被放置在堆中，这样就极大避免了永久代占满的问题，甚至永久代在<br>JDK 8 中被 MetaSpace（元数据区）替代了。而且，默认缓存大小也在不断地扩大中，从最初<br>的 1009，到 7u40 以后被修改为 60013。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX:+PrintStringTableStatistics</span><br></pre></td></tr></table></figure>
</li>
<li><p>Intern 是一种显式地排重机制，但是它也有一定的副作用，因为需要开发者写代码时明确调<br>用，一是不方便，每一个都显式调用是非常麻烦的；另外就是我们很难保证效率，应用开发阶段<br>很难清楚地预计字符串的重复情况，有人认为这是一种污染代码的实践。</p>
</li>
<li><p>Oracle JDK 8u20 之后，推出了一个新的特性，也就是 G1 GC 下的字符串排重。它是<br>通过将相同数据的字符串指向同一份数据来做到的，是 JVM 底层的改变，并不需要 Java 类库<br>做什么修改。</p>
</li>
</ul>
<p>使用下面参数开启，并且记得指定使用 G1 GC：<br><code>-XX:+UseStringDeduplication</code></p>
<h4 id="JVM的-Intrinsic"><a href="#JVM的-Intrinsic" class="headerlink" title="JVM的 Intrinsic"></a>JVM的 Intrinsic</h4><p>在运行时，字符串的一些基础操作会直接利用 JVM 内部的 Intrinsic机制，往往运行的就是特殊优化的本地代码，而根本就不是 Java 代码生成的字节码。<br><code>-XX:+PrintCompilation -XX:+UnlockDiagnosticVMOptions -XX:+PrintInlining</code></p>
<p>Intrinsic 机制 ：<br>利用 native 方式hard-coded的逻辑，算是一种特别的内联，很多优化还是需要直接使用特定的 CPU 指令.</p>
<hr>
<h3 id="clone-不用创建过程-不用重新计算对象的大小"><a href="#clone-不用创建过程-不用重新计算对象的大小" class="headerlink" title="clone 不用创建过程 不用重新计算对象的大小"></a>clone 不用创建过程 不用重新计算对象的大小</h3><p>必须重写<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">clone</span><span class="params">()</span></span>&#123;</span><br><span class="line">    TreeNode newT = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        newT = (TreeNode)<span class="keyword">super</span>.clone();</span><br><span class="line">    &#125;<span class="keyword">catch</span> (CloneNotSupportedException e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="Comparable-Comparator"><a href="#Comparable-Comparator" class="headerlink" title="Comparable Comparator"></a>Comparable<t> Comparator</t></h3><p>1.Arrys.sort:底层实现<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Comparable pivot = (Comparable) a[start];</span><br><span class="line"><span class="keyword">if</span> (pivot.compareTo(a[mid]) &lt; <span class="number">0</span>)</span><br></pre></td></tr></table></figure></p>
<p>2.Comparator面向对象，对修改关闭对扩展开放<br>新建类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxComparator implements Comparator&lt;T&gt;&#123;</span><br><span class="line">    compare(T o1,T o2)&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>sort传入比较器<br><code>Arrays.sort(t1,new xxxComparator())</code></p>
<hr>
<h3 id="System"><a href="#System" class="headerlink" title="System"></a>System</h3><p>1.时间<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Date nowtime  = <span class="keyword">new</span> Date(System.currentTimeMillis());</span><br><span class="line">DateFormat df = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"HH:mm:ss"</span>);</span><br><span class="line">String now = df.format(nowtime);</span><br></pre></td></tr></table></figure></p>
<p>2.<code>.exit()</code>退出JVM<br>3.当前工作目录<code>System.getProperty(&quot;user.dir&quot;)</code><br>    os.name/os.version/user.name/user.home/java.home/java.version<br>4.安卓加载三方类库<code>System.loadLibrary</code></p>
<hr>
<h3 id="Runtime-不new靠静态方法获取对象"><a href="#Runtime-不new靠静态方法获取对象" class="headerlink" title="Runtime 不new靠静态方法获取对象"></a>Runtime 不new靠静态方法获取对象</h3><ol>
<li><code>Runtime rt = Runtime.getRuntime();</code><br>可用处理器数量<code>rt.availableProcessors()</code><br>jvm总内存数<code>rt.totalMemory()</code><br>jvm空间内存<code>rt.freeMemory()</code><br>jvm最大可用内存<code>rt.maxMemory()</code></li>
<li>执行命令行命令<br><code>rt.exec(&quot;notepad&quot;)</code></li>
</ol>
<hr>
<p><a href="https://zhuanlan.zhihu.com/p/28016098" target="_blank" rel="noopener">java那些事</a><br><a href="https://www.ibm.com/support/knowledgecenter/zh/SSS28S_8.2.0/API/api_reference_holder_objects_java-filter_java.html" target="_blank" rel="noopener">ava API: Holder 对象</a></p>
<ol>
<li>1000_000编译器会直接删除_</li>
<li>十六进制p表示指数</li>
<li>$专门出现在自动产生的变量名中</li>
<li>方法外声明常量 static final （因为和对象无关，声明成类变量）</li>
<li>负数小心用%</li>
<li>浮点寄存器优化 strictfp修饰符</li>
<li><p>(int).. cast操作符警告 用Math.toIntExact会异常（越界or丢精度）</p>
</li>
<li><p>java不允许对象使用操作符 必须调用方法</p>
</li>
<li>input.split(“\s+”)以空格分割</li>
<li>在null上调用方法会空指针异常，所以与字面量比较要将文字串放前<code>&quot;word&quot;.equals(word)</code></li>
</ol>
<ul>
<li>code point 有效的unicode值</li>
</ul>
<hr>
<h3 id="Random"><a href="#Random" class="headerlink" title="Random"></a>Random</h3><ol>
<li>(1L &lt;&lt; 48) - 1</li>
</ol>
<h3 id="Character也有cache"><a href="#Character也有cache" class="headerlink" title="Character也有cache"></a>Character也有cache</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CharacterCache</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">CharacterCache</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Character cache[] = <span class="keyword">new</span> Character[<span class="number">127</span> + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; cache.length; i++)</span><br><span class="line">            cache[i] = <span class="keyword">new</span> Character((<span class="keyword">char</span>)i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//This method will always cache values in the range '\u0000' to '\u007F', inclusive,</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Character <span class="title">valueOf</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (c &lt;= <span class="number">127</span>) &#123; <span class="comment">// must cache</span></span><br><span class="line">        <span class="keyword">return</span> CharacterCache.cache[(<span class="keyword">int</span>)c];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Character(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Integer"><a href="#Integer" class="headerlink" title="Integer"></a>Integer</h3><h4 id="SIZE-BYTES常量-为了统一整数的位数"><a href="#SIZE-BYTES常量-为了统一整数的位数" class="headerlink" title="SIZE,BYTES常量 为了统一整数的位数"></a>SIZE,BYTES常量 为了统一整数的位数</h4><p>Java 语言规范里面，不管是 32 位还是 64 位环境，开发者无需担心数据的位数差异。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Bit twiddling</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The number of bits used to represent an &#123;<span class="doctag">@code</span> int&#125; value in two's</span></span><br><span class="line"><span class="comment"> * complement binary form.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Native</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The number of bytes used to represent a &#123;<span class="doctag">@code</span> int&#125; value in two's</span></span><br><span class="line"><span class="comment"> * complement binary form.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BYTES = SIZE / Byte.SIZE;</span><br></pre></td></tr></table></figure></p>
<h4 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h4><p>缓存机制并不是只有 Integer 才有，同样存在于其他的一些包装类<br>缓存上限值实际是可以根据需要调整的，JVM 提供了参数设置：<br><code>-XX:AutoBoxCacheMax=N</code></p>
<ul>
<li>Boolean，缓存了 true/false 对应实例，确切说，只会返回两个常量实例<br>Boolean.TRUE/FALSE。</li>
<li>Short，同样是缓存了 -128 到 127 之间的数值。</li>
<li>Byte，数值有限，所以全部都被缓存。</li>
<li>Character，缓存范围 ‘\u0000’ 到 ‘\u007F’。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer i3 =<span class="number">100</span>;Integer i4= <span class="number">100</span>;</span><br><span class="line">i3==i4;<span class="comment">//(true)同一个对象</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>享元模式：共享对象 将1字节以内的数缓存</p>
</blockquote>
<ul>
<li><p>Java 5 中新增了静态工厂方法 valueOf，在调用它的时候会利用一<br>个缓存机制，带来了明显的性能改进。<br>按照 Javadoc，这个值默认缓存是 -128 到 127 之间。</p>
</li>
<li><p>IntegerCache缓存数组 为避免重复创建对象</p>
</li>
<li>private static 内部静态类 只能在该类中访问,static用来做缓存<br><code>new Integer(2)==new Integer(2)</code> false<br><code>Integer.valueOf(2)==Integer.valueOf(2)</code> true 变成1000的时候因为缓存不一样<br><code>Integer.valueOf(2).intValue()==2</code> true<br><code>new Integer(2).equals(new Integer(2))</code> true</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//缓存-128到127之间的值</span></span><br><span class="line"> cache = <span class="keyword">new</span> Integer[(high - low) + <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">int</span> j = low;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; cache.length; k++)</span><br><span class="line">                cache[k] = <span class="keyword">new</span> Integer(j++);</span><br></pre></td></tr></table></figure>
<div><div class="fold_hider"><div class="close hider_title">展开代码</div></div><div class="fold">
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Cache to support the object identity semantics of autoboxing for values between</span></span><br><span class="line"><span class="comment"> * -128 and 127 (inclusive) as required by JLS.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The cache is initialized on first usage.  The size of the cache</span></span><br><span class="line"><span class="comment"> * may be controlled by the &#123;<span class="doctag">@code</span> -XX:AutoBoxCacheMax=&lt;size&gt;&#125; option.</span></span><br><span class="line"><span class="comment"> * During VM initialization, java.lang.Integer.IntegerCache.high property</span></span><br><span class="line"><span class="comment"> * may be set and saved in the private system properties in the</span></span><br><span class="line"><span class="comment"> * sun.misc.VM class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">IntegerCache</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> low = -<span class="number">128</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> high;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Integer cache[];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// high value may be configured by property</span></span><br><span class="line">        <span class="keyword">int</span> h = <span class="number">127</span>;</span><br><span class="line">        String integerCacheHighPropValue =</span><br><span class="line">            sun.misc.VM.getSavedProperty(<span class="string">"java.lang.Integer.IntegerCache.high"</span>);</span><br><span class="line">        <span class="keyword">if</span> (integerCacheHighPropValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> i = parseInt(integerCacheHighPropValue);</span><br><span class="line">                i = Math.max(i, <span class="number">127</span>);</span><br><span class="line">                <span class="comment">// Maximum array size is Integer.MAX_VALUE</span></span><br><span class="line">                h = Math.min(i, Integer.MAX_VALUE - (-low) -<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span>( NumberFormatException nfe) &#123;</span><br><span class="line">                <span class="comment">// If the property cannot be parsed into an int, ignore it.</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        high = h;</span><br><span class="line"></span><br><span class="line">        cache = <span class="keyword">new</span> Integer[(high - low) + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">int</span> j = low;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; cache.length; k++)</span><br><span class="line">            cache[k] = <span class="keyword">new</span> Integer(j++);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// range [-128, 127] must be interned (JLS7 5.1.7)</span></span><br><span class="line">        <span class="keyword">assert</span> IntegerCache.high &gt;= <span class="number">127</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">IntegerCache</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div></div>
<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer i3 =<span class="number">1000</span>;Integer i4= <span class="number">1000</span>;</span><br><span class="line">i3==i4;<span class="comment">//(false)new了两个对象</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">valueOf</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)</span><br><span class="line">           <span class="keyword">return</span> IntegerCache.cache[i + (-IntegerCache.low)];</span><br><span class="line">           <span class="comment">//没用cache返回了新对象</span></span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> Integer(i);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><strong>结论：Integer要用equals</strong></p>
<ul>
<li>char2int: b.charAt(i–)-‘0’; </li>
</ul>
<h4 id="自动装箱-自动拆箱是发生在什么阶段"><a href="#自动装箱-自动拆箱是发生在什么阶段" class="headerlink" title="自动装箱 / 自动拆箱是发生在什么阶段"></a>自动装箱 / 自动拆箱是发生在什么阶段</h4><p>自动装箱是一种语法糖。保证不同的写法在运行时等价，它们发生在<strong>编译</strong>阶段，也就是生成的字节码是一致的。</p>
<p>javac 替我们自动把装箱转换为 <code>Integer.valueOf()</code>，把拆箱替换为<br><code>Integer.intValue()</code></p>
<h4 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h4><p>建议避免无意中的装箱、拆箱行为，尤其是在性能敏感的场合，创建 10 万个 Java 对<br>象和 10 万个整数的开销不是一个数量级的，不管是内存使用还是处理速度，光是对象头的空<br>间占用就已经是数量级的差距了。</p>
<ul>
<li>使用原始数据类型、数组甚至本地代码实现等，在性能极度敏感的场景往往具有比较大的优势</li>
</ul>
<hr>
<h3 id="euqals"><a href="#euqals" class="headerlink" title="euqals"></a>euqals</h3><ul>
<li>没有实现equals的类：继承Object</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//是否指向同一对象，equal和==相同</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">this</span> == obj);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Integer的实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//判断类型</span></span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Integer) &#123;</span><br><span class="line">    <span class="comment">//？？强制转型</span></span><br><span class="line">            <span class="keyword">return</span> value == ((Integer)obj).intValue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">intValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>String实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object anObject)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//指向引用</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == anObject) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//类型 写法注意！！</span></span><br><span class="line">        <span class="keyword">if</span> (anObject <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            String anotherString = (String)anObject;</span><br><span class="line">            <span class="keyword">int</span> n = value.length;</span><br><span class="line">            <span class="comment">//长度？？可以调用private的value</span></span><br><span class="line">            <span class="keyword">if</span> (n == anotherString.value.length) &#123;</span><br><span class="line">                <span class="keyword">char</span> v1[] = value;</span><br><span class="line">                <span class="keyword">char</span> v2[] = anotherString.value;</span><br><span class="line">                <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> (n-- != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (v1[i] != v2[i])</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="native"><a href="#native" class="headerlink" title="native"></a>native</h3><blockquote>
<p>native是由操作系统实现的，C/C++实现，java去调用。</p>
</blockquote>
<ul>
<li><code>Arrays.copyOf-&gt;System.arraycopy(org,0,copy,0,len)</code></li>
</ul>
<hr>
<h3 id="Java8"><a href="#Java8" class="headerlink" title="Java8"></a>Java8</h3><ul>
<li>default方法：接口内部有方法实现；实现两个接口有同名default名字冲突-&gt;报错</li>
</ul>
<hr>
<h3 id="synchronized-JVM实现"><a href="#synchronized-JVM实现" class="headerlink" title="synchronized JVM实现"></a>synchronized JVM实现</h3><h3 id="泛型和原始数据类型"><a href="#泛型和原始数据类型" class="headerlink" title="泛型和原始数据类型"></a>泛型和原始数据类型</h3><p>Java 的对象都是引用类型，<br>如果是一个 <strong>原始数据类型数组</strong>，它在内存里是一段连续的内存，<br>而<strong>对象数组</strong>则不然，数据存储的是引用，对象往往是分散地存储在堆的不同位置。</p>
<p>导致了数据操作的低效，尤其是无法充分利用现代 CPU 缓存机制。</p>
<h3 id="java对象的内存结构"><a href="#java对象的内存结构" class="headerlink" title="java对象的内存结构"></a>java对象的内存结构</h3><p>对象在内存中存储的布局可以分为3块区域：对象头（Header）、实例数据（Instance Data）和对齐填充（Padding）。</p>
<h4 id="对象头8字节"><a href="#对象头8字节" class="headerlink" title="对象头8字节"></a>对象头8字节</h4><ol>
<li>Mark Word:标记位 4字节：第一部分用于存储对象自身的运行时数据，如哈<br>希码（HashCode）、GC分代年龄、锁状态标志、线程持有的锁、偏向线程ID、偏向时间戳<br>等，这部分数据的长度在32位和64位的虚拟机（未开启压缩指针）中分别为32bit和64bit，<br>官方称它为”Mark Word”。 </li>
</ol>
<p>前4保存对象hash(3)，锁状态(1)<br>后4存储对象所属类的引用。</p>
<p>数组还有4字节保存数组大小。</p>
<h4 id="Integer-1"><a href="#Integer-1" class="headerlink" title="Integer"></a>Integer</h4><ol>
<li>Mark Word:标记位 4字节，类似轻量级锁标记位，偏向锁标记位等。 </li>
<li>Class对象指针:4字节，指向对象对应class对象的内存地址。 </li>
<li>对象实际数据:对象所有成员变量。 </li>
<li>对齐:对齐填充字节，按照8个字节填充。 </li>
</ol>
<p>Integer占用内存大小，4+4+4+4=16字节。</p>
<h4 id="java内存"><a href="#java内存" class="headerlink" title="java内存"></a>java内存</h4><p><a href="https://algs4.cs.princeton.edu/14analysis/" target="_blank" rel="noopener">https://algs4.cs.princeton.edu/14analysis/</a><br><a href="http://yueyemaitian.iteye.com/blog/2034305" target="_blank" rel="noopener">http://yueyemaitian.iteye.com/blog/2034305</a><br><a href="https://blog.csdn.net/zhxdick/article/details/52003123" target="_blank" rel="noopener">https://blog.csdn.net/zhxdick/article/details/52003123</a></p>
<h4 id="object"><a href="#object" class="headerlink" title="object"></a>object</h4><p>object overhead 16+int 4 padded到4的倍数(<code>-XX:-UseCompressedOops:</code>)<br>如果用压缩则<code>-XX:+UseCompressedOops: mark/4 + metedata/8 + 4 = 16</code><br>默认是启动压缩的<br><img src="https://iota-1254040271.cos.ap-shanghai.myqcloud.com/image/javaobj.jpg" alt="javaobj.jpg"></p>
<blockquote>
<p>Objects. To determine the memory usage of an object, we add the amount of memory used by each instance variable to the overhead associated with each object, typically 16 bytes. Moreover, the memory usage is typically padded to be a multiple of 8 bytes (on a 64-bit machine).</p>
</blockquote>
<h4 id="padding"><a href="#padding" class="headerlink" title="padding"></a>padding</h4><p>This can waste some memory but it speeds up memory access and garbage collection.</p>
<h4 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h4><p>// todo<br>引用类型是内存地址，8字节<br>2*ref(8)+enclosing(8)+16head = 40<br>非静态有encolsing instance？<br>指针的大小在bit模式下或64bit开启指针压缩下默认为4byte<br> UseCompressOops开启和关闭，对对象头大小是有影响的，开启压缩，对象头是4+8=12byte；关闭压缩，对象头是8+8=16bytes。<br><code>java -Xmx31g -XX:+PrintFlagsFinal |findstr Compress</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uintx CompressedClassSpaceSize     = 1073741824     &#123;product&#125;</span><br><span class="line">bool UseCompressedClassPointers    := true          &#123;lp64_product&#125;</span><br><span class="line">bool UseCompressedOops             := true          &#123;lp64_product&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://iota-1254040271.cos.ap-shanghai.myqcloud.com/image/javarefer.jpg" alt="javarefer.jpg"></p>
<blockquote>
<p>References. A reference to an object typically is a memory address and thus uses 8 bytes of memory (on a 64-bit machine).</p>
</blockquote>
<h4 id="arrays"><a href="#arrays" class="headerlink" title="arrays"></a>arrays</h4><p><img src="https://iota-1254040271.cos.ap-shanghai.myqcloud.com/image/javaarr.jpg" alt="javaarr.jpg"></p>
<blockquote>
<p>Arrays. Arrays in Java are implemented as objects, typically with extra overhead for the length. An array of primitive-type values typically requires 24 bytes of header information (16 bytes of object overhead, 4 bytes for the length, and 4 bytes of padding) plus the memory needed to store the values.</p>
</blockquote>
<p>基本类型 16的obj head+4(len)+4padding = 24 +存的类型*长度</p>
<h4 id="string"><a href="#string" class="headerlink" title="string"></a>string</h4><p>char[] ref(8)+int(4)+head(16)+padding-&gt;32+char<a href="arrayschar(24"></a>)=56+2N<br><img src="https://iota-1254040271.cos.ap-shanghai.myqcloud.com/image/javastr.jpg" alt="javastr.jpg"></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/java/" rel="tag"># java</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/03/07/Front-end-questions/" rel="next" title="Front-end questions">
                <i class="fa fa-chevron-left"></i> Front-end questions
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/03/08/Python-models/" rel="prev" title="Python modules">
                Python modules <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description">学习一个技术不要轻易过去，要有技术深度做一个demo</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">72</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#BigInteger"><span class="nav-number">1.</span> <span class="nav-text">BigInteger</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LinkedHashMap-LRU的写法"><span class="nav-number">2.</span> <span class="nav-text">LinkedHashMap:LRU的写法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#String"><span class="nav-number">3.</span> <span class="nav-text">String</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#源码："><span class="nav-number">3.1.</span> <span class="nav-text">源码：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Object"><span class="nav-number">4.</span> <span class="nav-text">Object</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DecimalFormat"><span class="nav-number">5.</span> <span class="nav-text">DecimalFormat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串存储-紧凑字符串"><span class="nav-number">6.</span> <span class="nav-text">字符串存储 紧凑字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#编码"><span class="nav-number">6.1.</span> <span class="nav-text">编码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串拼接"><span class="nav-number">7.</span> <span class="nav-text">字符串拼接</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#StringBuffer"><span class="nav-number">7.1.</span> <span class="nav-text">StringBuffer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#StringBuilder"><span class="nav-number">7.2.</span> <span class="nav-text">StringBuilder</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串缓存"><span class="nav-number">8.</span> <span class="nav-text">字符串缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#JVM的-Intrinsic"><span class="nav-number">8.1.</span> <span class="nav-text">JVM的 Intrinsic</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#clone-不用创建过程-不用重新计算对象的大小"><span class="nav-number">9.</span> <span class="nav-text">clone 不用创建过程 不用重新计算对象的大小</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Comparable-Comparator"><span class="nav-number">10.</span> <span class="nav-text">Comparable Comparator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#System"><span class="nav-number">11.</span> <span class="nav-text">System</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Runtime-不new靠静态方法获取对象"><span class="nav-number">12.</span> <span class="nav-text">Runtime 不new靠静态方法获取对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Random"><span class="nav-number">13.</span> <span class="nav-text">Random</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Character也有cache"><span class="nav-number">14.</span> <span class="nav-text">Character也有cache</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Integer"><span class="nav-number">15.</span> <span class="nav-text">Integer</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SIZE-BYTES常量-为了统一整数的位数"><span class="nav-number">15.1.</span> <span class="nav-text">SIZE,BYTES常量 为了统一整数的位数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#缓存"><span class="nav-number">15.2.</span> <span class="nav-text">缓存</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自动装箱-自动拆箱是发生在什么阶段"><span class="nav-number">15.3.</span> <span class="nav-text">自动装箱 / 自动拆箱是发生在什么阶段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#性能优化"><span class="nav-number">15.4.</span> <span class="nav-text">性能优化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#euqals"><span class="nav-number">16.</span> <span class="nav-text">euqals</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#native"><span class="nav-number">17.</span> <span class="nav-text">native</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java8"><span class="nav-number">18.</span> <span class="nav-text">Java8</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#synchronized-JVM实现"><span class="nav-number">19.</span> <span class="nav-text">synchronized JVM实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#泛型和原始数据类型"><span class="nav-number">20.</span> <span class="nav-text">泛型和原始数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#java对象的内存结构"><span class="nav-number">21.</span> <span class="nav-text">java对象的内存结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#对象头8字节"><span class="nav-number">21.1.</span> <span class="nav-text">对象头8字节</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Integer-1"><span class="nav-number">21.2.</span> <span class="nav-text">Integer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java内存"><span class="nav-number">21.3.</span> <span class="nav-text">java内存</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#object"><span class="nav-number">21.4.</span> <span class="nav-text">object</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#padding"><span class="nav-number">21.5.</span> <span class="nav-text">padding</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#reference"><span class="nav-number">21.6.</span> <span class="nav-text">reference</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#arrays"><span class="nav-number">21.7.</span> <span class="nav-text">arrays</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#string"><span class="nav-number">21.8.</span> <span class="nav-text">string</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/custom/custom.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
